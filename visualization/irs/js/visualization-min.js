function researchMode(){var t=$("#mStory"),e=$("#mResearch");t.removeClass("viewerChosen"),e.addClass("viewerChosen")}function storyMode(){var t=$("#mStory");$("#mResearch").removeClass("viewerChosen"),t.addClass("viewerChosen")}function drawStoryOptions(){d3.json("js/data/stories/stories.json",function(t){for(var e=0;e<t.stories.length;e++){var o=d3.select("#stories-select").append("div").attr("class","story-option-container").attr("id",t.stories[e].id).on("click",function(t,e){storyID=d3.select(this).attr("id"),d3.selectAll(".story-option-container").transition().duration(200).ease(d3.easeLinear).style("opacity",.1),d3.select("#"+storyID).transition().duration(200).ease(d3.easeLinear).style("opacity",1),drawStory(storyID)});d3.select("#"+t.stories[e].id).append("div").attr("class","story-option-circle").attr("id","story-option"+e).style("background","linear-gradient(rgba(241, 90, 36, 0.25),rgba(241, 90, 36, 0.25)), url('js/data/stories/images/"+t.stories[e].picture+"'), rgb(241, 90, 36)").style("background-size","10em");d3.select("#"+t.stories[e].id).append("div").attr("class","story-label").html("<p class='story-option-name'>"+t.stories[e].name+"</p><p class='story-option-quote'>&ldquo;"+t.stories[e].pull+"&rdquo;</p>")}})}function drawStory(t){d3.select(".storyTime").remove();var e=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,d3.json("js/data/stories/stories.json",function(o){var r=o.stories.filter(function(e){return e.id===t});r=r[0];var n=r.name,a=r.bio,s=r.schoolBio;storySelected=r.name+" was",pageSix(n);var l=d3.select("#storyTime").append("div").attr("class","storyTime").html("<div id='storyName'></div><div id='storyBio'></div><div id='storySchoolBio'></div><div id='storyStories'></div>"),i=d3.select("#storyName").append("h1").attr("class","name").html("<span class='storyName'>"+n+"</span>"),c=d3.select("#storyBio").append("div").attr("class","bio").html("<p>"+a+"</p>"),d=d3.select("#storySchoolBio").append("div").attr("class","schoolBio").html("<p>"+s+"</p>");storyName_p=new ScrollMagic.Scene({triggerElement:"#storyName",duration:"100%"}).offset(document.getElementById("storyName").offsetHeight/2+"px").setPin("#storyName").addTo(e),storyBio_p=new ScrollMagic.Scene({triggerElement:"#storyBio",duration:"100%"}).offset(document.getElementById("storyBio").offsetHeight/2+"px").setPin("#storyBio").addTo(e),storySchoolBio_p=new ScrollMagic.Scene({triggerElement:"#storySchoolBio",duration:"100%"}).offset(document.getElementById("storySchoolBio").offsetHeight/2+"px").setPin("#storySchoolBio").addTo(e);for(var y=TweenMax.to("#storyName",.5,{opacity:"0"}),p=TweenMax.to("#storyBio",.5,{opacity:"0"}),g=TweenMax.to("#storySchoolBio",.5,{opacity:"0"}),u=new ScrollMagic.Scene({triggerElement:"#storyBio"}).triggerHook("onEnter").setTween(y).addTo(e),m=new ScrollMagic.Scene({triggerElement:"#storySchoolBio"}).triggerHook("onEnter").setTween(p).addTo(e),L=new ScrollMagic.Scene({triggerElement:"#storyStories"}).triggerHook("onEnter").setTween(g).addTo(e),f=0;f<r.story.length;f++){var h=d3.select("#storyStories").append("div").attr("class","storyStories").attr("id","story-"+f);if(""===r.story[f].quote){var v=r.story[f].section,w=r.story[f].pre;h.html("<p class='story-section'>"+v+"</p><p class='story-quote'>"+w+"</p>")}else{var v=r.story[f].section,w=r.story[f].pre,T=r.story[f].quote,S=RiString(T),x=S.words(),A=S.pos();h.html("<p class='story-section'>"+v+"</p><p class='story-pre'>"+w+"</p><p class='story-quote'>&ldquo;<span id='story-quote-"+f+"'></span>&rdquo;</p>")}for(var D=0;D<x.length;D++)if(/[,.?\-]/.test(x[D+1]))var M=d3.select("#story-quote-"+f).append("span").attr("id","quote-"+D).attr("class","pos-"+A[D]).html(x[D]);else var M=d3.select("#story-quote-"+f).append("span").attr("id","quote-"+D).attr("class","pos-"+A[D]).html(x[D]+" ")}for(var f=0;f<r.story.length-1;f++){var E=f+1,k=new ScrollMagic.Scene({triggerElement:"#story-"+f,duration:"100%"}).offset(document.getElementById("story-"+f).offsetHeight/2+"px").setPin("#story-"+f).addTo(e),b=TweenMax.to("#story-"+f,.5,{opacity:"0"});if(f<r.story.length)var P=new ScrollMagic.Scene({triggerElement:"#story-"+E}).triggerHook("onEnter").setTween(b).addTo(e)}var I=r.story.length-1;storyStory_last_p=new ScrollMagic.Scene({triggerElement:"#story-"+I,duration:"100%"}).offset(document.getElementById("story-"+I).offsetHeight/2+"px").setPin("#story-"+I).addTo(e);var b=TweenMax.to("#story-"+I,.5,{opacity:"0"}),P=new ScrollMagic.Scene({triggerElement:"#p6"}).triggerHook("onEnter").setTween(b).addTo(e)})}function pageSix(t){d3.selectAll(".overlay").remove(),d3.selectAll(".dot").classed("schoolMarker",!0).style("opacity",1),d3.selectAll(".label").classed("schoolLabel",!0).style("opacity",1);var e=d3.select("#oneof").append("div").attr("class","overlay").html(storySelected+" one of an estimated <span class='orange'>150,000</span> Aboriginal children to attend a residential school in Canada."),o=d3.select("#thismany").append("div").attr("class","overlay").html("There were <span class='orange'>132</span> schools located throughout the country."),r=d3.select("#fromreserves").append("div").attr("class","overlay").html("Students were drawn from reserves, bands, and tribes all over Canada, some as far away as <span class='orange'>8000km</span>."),n=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,d3.json("js/data/stories/stories.json",function(e){e=e.stories.filter(function(e){return e.name===t}),e=e[0],map.setView([e.latLng.lat,e.latLng.lng],e.zoom,{animate:!1}),d3.select("#dot-"+e.schoolID).classed("schoolMarker",!1),d3.select("#label-"+e.schoolID).classed("schoolLabel",!1),new ScrollMagic.Scene({triggerElement:"#tMap1_zo"}).addTo(n).on("progress",function(t){"FORWARD"===t.scrollDirection?(d3.selectAll(".schoolLabel").style("opacity","0"),d3.selectAll(".schoolMarker").style("opacity","0"),map.setView([57,-100],4.5,{animate:!0})):(d3.select("#dot-"+e.schoolID).style("opacity",1),d3.select("#label-"+e.schoolID).style("opacity",1),map.setView([e.latLng.lat,e.latLng.lng],e.zoom,{animate:!0}))}),new ScrollMagic.Scene({triggerElement:"#tMap1_irs"}).addTo(n).on("progress",function(t){"FORWARD"===t.scrollDirection?(d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",1),d3.select("#label-"+e.schoolID).transition().duration(600).ease(d3.easeLinear).style("opacity",0)):(d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",0),d3.select("#label-"+e.schoolID).transition().duration(600).ease(d3.easeLinear).style("opacity",1))}),new ScrollMagic.Scene({triggerElement:"#tMap1_reserves"}).addTo(n).on("progress",function(t){"FORWARD"===t.scrollDirection?d3.selectAll(".reserveDot").style("display","block").transition().duration(600).ease(d3.easeLinear).style("opacity",.1):(d3.selectAll(".reserveDot").transition().duration(600).ease(d3.easeLinear).style("opacity",0),d3.selectAll(".reserveDot").transition().delay(600).style("display","none"))});var o=new ScrollMagic.Scene({triggerElement:"#oneof",duration:"100%"}).offset(document.getElementById("oneof").offsetHeight/2+"px").setPin("#oneof").addTo(n),r=new ScrollMagic.Scene({triggerElement:"#thismany",duration:"100%"}).offset(document.getElementById("thismany").offsetHeight/2+"px").setPin("#thismany").addTo(n),a=new ScrollMagic.Scene({triggerElement:"#fromreserves",duration:"100%"}).offset(document.getElementById("fromreserves").offsetHeight/2+"px").setPin("#fromreserves").addTo(n)})}function camelize(t){return t.replace(/[.,\'\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}window.onload=drawStoryOptions;var storyID="aelias",storySelected="These students were",orange="#f15a24";jQuery(document).ready(function($){function t(){var t=$(window).scrollTop();n-t>s?e.removeClass("is-hidden"):t-n>s&&t>l&&e.addClass("is-hidden"),n=t,r=!1}var e=$(".auto-hide-header"),o=e.height();e.addClass("is-hidden");var r=!1,n=0,a=0,s=10,l=150;$(window).on("scroll",function(){r||(r=!0,window.requestAnimationFrame?requestAnimationFrame(t):setTimeout(t,250))}),$(window).on("resize",function(){o=e.height()})}),jQuery("#stories-select").draggable({axis:"x",cursor:"move",containment:"stories"});var controller=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1;var drawStory_s=new ScrollMagic.Scene({triggerElement:"#p4"}).on("enter",function(t){drawStory(storyID),pageSix("Albert Elias")}).triggerHook("onEnter").addTo(controller),map1=d3.select("#map1_cont").append("div").attr("class","map").attr("id","map1");d3.select("#map1").style("height",window.innerHeight+"px").style("width",window.innerWidth+"px");var map=L.map("map1",{zoomControl:!0,scrollWheelZoom:!1,dragging:!L.Browser.mobile,touchZoom:!0,doubleClickZoom:!0,boxZoom:!1,tap:!1,keyboard:!1}).setView([50.12052777777778,-92.01173055555556],7);L.tileLayer("https://api.mapbox.com/styles/v1/svickars/cj15o81vo00212rqu9mw0wgkp/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic3ZpY2thcnMiLCJhIjoiY2l1aW5saDhkMDAwMTNvbDdmcTlncnp1cyJ9.wIpJKF-DW1C2uPgKnUtNWg",{}).addTo(map);var map1_p=new ScrollMagic.Scene({triggerElement:"#tMap1_p",duration:"500%"}).triggerHook("onLeave").setPin("#map1_cont").addIndicators({name:"map_pin"}).addTo(controller),svgLayer=L.svg();svgLayer.addTo(map);var mapsvg=d3.select("#map1").select("svg"),g=mapsvg.append("g");d3.json("js/data/locations.json",function(t){function e(){l.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"}),d.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"}),y.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"}),i.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"}),s.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"}),c.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"})}function o(t){d3.select("#dot-"+t.schoolID).classed("schoolMarker",!1),d3.selectAll(".schoolMarker").style("opacity",".25"),d3.select("#dot-"+t.schoolID).style("fill","#333").style("opacity",1),d3.selectAll("#sTip-"+t.schoolID).style("opacity","1.0"),""===t.listConnections||(d3.selectAll(t.class).classed("reserveDot",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity",".6")),d3.selectAll(".reserveDot").style("opacity",".05"),d3.selectAll(".connection").style("opacity",".05")}function r(t){d3.select("#rDot-"+t.id).classed("reserveDot",!1),d3.selectAll(".reserveDot").style("opacity",".025").style("fill","#333"),d3.selectAll("#rTip-"+t.id).style("opacity","1.0"),""===t.listConnections||(d3.selectAll(t.class).classed("schoolMarker",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity","1"),d3.select("#rDot-"+t.id).style("opacity",.25)),d3.selectAll(".schoolMarker").style("opacity",".25"),d3.selectAll(".connection").style("opacity",".05")}function n(t){d3.selectAll(".dot").classed("schoolMarker",!0),d3.selectAll(".schoolMarker").style("fill",orange).style("opacity","1"),d3.selectAll("#sTip-"+t.schoolID).style("opacity","0"),d3.selectAll(".sTooltip").style("opacity","0"),d3.selectAll(".sTooltip2").style("opacity","0"),d3.selectAll(".rDot").classed("reserveDot",!0),d3.selectAll(".reserveDot").style("opacity",".1"),d3.selectAll(".conn").classed("connection",!0),d3.selectAll(".connection").style("opacity","0.25")}function a(t){d3.selectAll(".rDot").classed("reserveDot",!0),d3.selectAll(".reserveDot").style("opacity",".1"),d3.selectAll(".dot").classed("schoolMarker",!0),d3.selectAll(".schoolMarker").style("opacity","1"),d3.selectAll(".conn").classed("connection",!0),d3.selectAll(".connection").style("opacity","0.25"),d3.selectAll("#rTip-"+t.id).style("opacity","0"),d3.selectAll(".rTooltip").style("opacity","0")}t.schools.forEach(function(t){t.LatLng=new L.LatLng(t.latitude,t.longitude)}),t.reservations.forEach(function(t){t.LatLng=new L.LatLng(t.lat,t.lng)});var s=g.selectAll(".rDot").data(t.reservations).enter().append("circle",".rDot").attr("pointer-events","visible").attr("class",function(t){return"rDot reserveDot "+t.listConnections}).attr("id",function(t){return"rDot-"+t.id}).style("stroke","none").style("display","none").style("opacity","0").style("fill","#333").attr("r",15).on("mouseover",r).on("mouseout",a),l=g.selectAll(".sCircle").data(t.schools).enter().append("circle",".sCircle").attr("class",function(t){return"schoolMarker dot "+t.listConnections}).attr("pointer-events","visible").attr("id",function(t){return"dot-"+t.schoolID}).style("stroke","none").style("opacity",1).style("fill",orange).attr("r",5).on("mouseover",o).on("mouseout",n),i=g.selectAll("text").data(t.schools).enter().append("text").attr("class","label schoolLabel").attr("id",function(t){return"label-"+t.schoolID}).attr("dy","6px").attr("dx","10px").text(function(t){return t.locationName+" "+t.title}),c=g.selectAll(".rTip").data(t.reservations).enter().append("text",".rtip").attr("class","rTooltip").attr("id",function(t){return"rTip-"+t.id}).attr("dx","20px").attr("dy","5px").text(function(t){return t.reserve}),d=g.selectAll(".sTip").data(t.schools).enter().append("text",".stip").attr("class","sTooltip").attr("id",function(t){return"sTip-"+t.schoolID}).attr("dx","9px").attr("dy","5px").text(function(t){return t.locationName+" "+t.title}),y=g.selectAll(".sTip2").data(t.schools).enter().append("text",".stip2").attr("class","sTooltip2").attr("id",function(t){return"sTip-"+t.schoolID}).attr("dx","9px").attr("dy","19px").text(function(t){return t.start+" - "+t.end});map.on("viewreset",e),map.on("zoomend",e),e()}),d3.json("js/data/connections.json",function(t){function e(){!1===r?o.attr("x1",function(t){return map.latLngToLayerPoint(t.sLatLng).x}).attr("y1",function(t){return map.latLngToLayerPoint(t.sLatLng).y}).attr("x2",function(t){return map.latLngToLayerPoint(t.sLatLng).x}).attr("y2",function(t){return map.latLngToLayerPoint(t.sLatLng).y}):o.attr("x1",function(t){return map.latLngToLayerPoint(t.sLatLng).x}).attr("y1",function(t){return map.latLngToLayerPoint(t.sLatLng).y}).attr("x2",function(t){return map.latLngToLayerPoint(t.eLatLng).x}).attr("y2",function(t){return map.latLngToLayerPoint(t.eLatLng).y})}t.forEach(function(t){t.sLatLng=new L.LatLng(t.sLat,t.sLng),t.eLatLng=new L.LatLng(t.eLat,t.eLng)});var o=g.selectAll("line").data(t).enter().append("line").attr("class",function(t){return"connection conn "+t.id}).attr("id",function(t){return"conn-"+t.id}).style("stroke",orange).style("opacity",.25),r=!1;map.on("viewreset",e),map.on("zoomend",e),e(),new ScrollMagic.Scene({triggerElement:"#tMap1_connections"}).addTo(controller).on("progress",function(t){"FORWARD"===t.scrollDirection?(r=!0,o.transition().duration(1500).attr("x2",function(t){return map.latLngToLayerPoint(t.eLatLng).x}).attr("y2",function(t){return map.latLngToLayerPoint(t.eLatLng).y})):(r=!1,o.transition().duration(1500).attr("x2",function(t){return map.latLngToLayerPoint(t.sLatLng).x}).attr("y2",function(t){return map.latLngToLayerPoint(t.sLatLng).y}))})});