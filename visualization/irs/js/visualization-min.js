function drawStoryOptions(){d3.json("js/data/stories/stories.json",function(t){for(var e=0;e<t.stories.length;e++){var o=d3.select("#stories-select").append("div").attr("class","story-option-container").attr("id",t.stories[e].id).on("click",function(t,e){storyID=d3.select(this).attr("id"),d3.selectAll(".story-option-container").transition().duration(200).ease(d3.easeLinear).style("opacity",.1),d3.select("#"+storyID).transition().duration(200).ease(d3.easeLinear).style("opacity",1),drawStory(storyID)});d3.select("#"+t.stories[e].id).append("div").attr("class","story-option-circle").attr("id","story-option"+e).style("background","linear-gradient(rgba(241, 90, 36, 0.25),rgba(241, 90, 36, 0.25)), url('js/data/stories/images/"+t.stories[e].picture+"'), rgb(241, 90, 36)").style("background-size","10em");d3.select("#"+t.stories[e].id).append("div").attr("class","story-label").html("<p class='story-option-name'>"+t.stories[e].name+"</p><p class='story-option-quote'>&ldquo;"+t.stories[e].pull+"&rdquo;</p>")}})}function drawStory(t){d3.select(".storyTime").remove();var e=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,d3.json("js/data/stories/stories.json",function(o){var r=o.stories.filter(function(e){return e.id===t});r=r[0];var s=r.name,a=r.bio,n=r.schoolBio;storySelected=r.name+" was",pageSix(s);var i=d3.select("#storyTime").append("div").attr("class","storyTime").html("<div id='storyName'></div><div id='storyBio'></div><div id='storySchoolBio'></div><div id='storyStories'></div>"),l=d3.select("#storyName").append("h1").attr("class","name").html("<span class='storyName'>"+s+"</span>"),d=d3.select("#storyBio").append("div").attr("class","bio").html("<p>"+a+"</p>"),c=d3.select("#storySchoolBio").append("div").attr("class","schoolBio").html("<p>"+n+"</p>");storyName_p=new ScrollMagic.Scene({triggerElement:"#storyName",duration:"100%"}).offset(document.getElementById("storyName").offsetHeight/2+"px").setPin("#storyName").addTo(e),storyBio_p=new ScrollMagic.Scene({triggerElement:"#storyBio",duration:"100%"}).offset(document.getElementById("storyBio").offsetHeight/2+"px").setPin("#storyBio").addTo(e),storySchoolBio_p=new ScrollMagic.Scene({triggerElement:"#storySchoolBio",duration:"100%"}).offset(document.getElementById("storySchoolBio").offsetHeight/2+"px").setPin("#storySchoolBio").addTo(e);for(var p=TweenMax.to("#storyName",.5,{opacity:"0"}),y=TweenMax.to("#storyBio",.5,{opacity:"0"}),g=TweenMax.to("#storySchoolBio",.5,{opacity:"0"}),m=new ScrollMagic.Scene({triggerElement:"#storyBio"}).triggerHook("onEnter").setTween(p).addTo(e),u=new ScrollMagic.Scene({triggerElement:"#storySchoolBio"}).triggerHook("onEnter").setTween(y).addTo(e),h=new ScrollMagic.Scene({triggerElement:"#storyStories"}).triggerHook("onEnter").setTween(g).addTo(e),w=0;w<r.story.length;w++){var v=d3.select("#storyStories").append("div").attr("class","storyStories").attr("id","story-"+w),f=r.story[w].section,S=r.story[w].pre,T=r.story[w].quote,L=RiString(T),x=L.words(),E=L.pos();""===r.story[w].quote?v.html("<p class='story-section'>"+f+"</p><p class='story-quote'>"+S+"</p>"):v.html("<p class='story-section'>"+f+"</p><p class='story-pre'>"+S+"</p><p class='story-quote'>&ldquo;<span id='story-quote-"+w+"'></span>&rdquo;</p>");for(var M=0;M<x.length;M++)if(/[,.?\-]/.test(x[M+1]))var B=d3.select("#story-quote-"+w).append("span").attr("id","quote-"+M).attr("class","pos-"+E[M]).html(x[M]);else var B=d3.select("#story-quote-"+w).append("span").attr("id","quote-"+M).attr("class","pos-"+E[M]).html(x[M]+" ")}for(var w=0;w<r.story.length-1;w++){var b=w+1,j=new ScrollMagic.Scene({triggerElement:"#story-"+w,duration:"100%"}).offset(document.getElementById("story-"+w).offsetHeight/2+"px").setPin("#story-"+w).addTo(e),k=TweenMax.to("#story-"+w,.5,{opacity:"0"});if(w<r.story.length)var q=new ScrollMagic.Scene({triggerElement:"#story-"+b}).triggerHook("onEnter").setTween(k).addTo(e)}var I=r.story.length-1;storyStory_last_p=new ScrollMagic.Scene({triggerElement:"#story-"+I,duration:"100%"}).offset(document.getElementById("story-"+I).offsetHeight/2+"px").setPin("#story-"+I).addTo(e);var k=TweenMax.to("#story-"+I,.5,{opacity:"0"}),q=new ScrollMagic.Scene({triggerElement:"#p6"}).triggerHook("onEnter").setTween(k).addTo(e)})}function pageSix(t){d3.select(".p6header").remove();var e=d3.select("#p6header").append("h1").attr("class","p6header").html(storySelected+" one of an estimated <span class='orange'>150,000</span> Aboriginal children to attend a residential school in Canada."),o=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,d3.json("js/data/stories/stories.json",function(e){e=e.stories.filter(function(e){return e.name===t}),e=e[0],map.setView([e.latLng.lat,e.latLng.lng],e.zoom,{animate:!1})});var r=new ScrollMagic.Scene({triggerElement:"#tMap1_p",duration:"200%"}).triggerHook("onLeave").setPin("#map1").addIndicators({name:"map_pin"}).addTo(o)}window.onload=drawStoryOptions;var storyID="aelias",storySelected="These students were",orange="#f15a24";jQuery(document).ready(function($){function t(){var t=$(window).scrollTop();s-t>n?e.removeClass("is-hidden"):t-s>n&&t>i&&e.addClass("is-hidden"),s=t,r=!1}var e=$(".auto-hide-header"),o=e.height(),r=!1,s=0,a=0,n=10,i=150;$(window).on("scroll",function(){r||(r=!0,window.requestAnimationFrame?requestAnimationFrame(t):setTimeout(t,250))}),$(window).on("resize",function(){o=e.height()})}),jQuery("#stories-select").draggable({axis:"x",cursor:"move",containment:"stories"});var controller=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1;var drawStory_s=new ScrollMagic.Scene({triggerElement:"#p4"}).on("enter",function(t){drawStory(storyID),pageSix("Albert Elias")}).triggerHook("onEnter").addTo(controller),map1=d3.select("#map1_cont").append("div").attr("class","map").attr("id","map1");d3.select("#map1").style("height",window.innerHeight+"px").style("width",window.innerWidth+"px");var map=L.map("map1",{zoomControl:!1,scrollWheelZoom:!1,dragging:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,tap:!1,keyboard:!1}).setView([50.12052777777778,-92.01173055555556],7);L.tileLayer("https://api.mapbox.com/styles/v1/svickars/cj15o81vo00212rqu9mw0wgkp/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic3ZpY2thcnMiLCJhIjoiY2l1aW5saDhkMDAwMTNvbDdmcTlncnp1cyJ9.wIpJKF-DW1C2uPgKnUtNWg",{}).addTo(map);var svgLayer=L.svg();svgLayer.addTo(map);var mapsvg=d3.select("#map1").select("svg"),g=mapsvg.append("g");d3.json("js/data/school_locations.json",function(t){function e(){o.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"}),r.attr("transform",function(t){return"translate("+map.latLngToLayerPoint(t.LatLng).x+","+map.latLngToLayerPoint(t.LatLng).y+")"})}t.schools.forEach(function(t){t.LatLng=new L.LatLng(t.latitude,t.longitude),t.label=t.type});var o=g.selectAll("circle").data(t.schools).enter().append("circle").style("stroke","none").style("opacity",1).style("fill",orange).attr("r",5),r=g.selectAll("text").data(t.schools).enter().append("text").attr("class","schoolLabel").attr("dy","6px").attr("dx","10px").text(function(t){return t.locationName+" "+t.title});map.on("viewreset",e),e()});