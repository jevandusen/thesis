function getD3(){var t=document.body.getBoundingClientRect(),e=map.getCenter(),r=map.getZoom(),o=256/Math.PI*Math.pow(2,r);return d3.geoMercator().center([e.lng,e.lat]).translate([t.width/2,t.height/2]).scale(o)}function drawStory(t){d3.select(".storyTime").remove(),d3.json("js/data/stories/stories.json",function(e){var r=e.stories.filter(function(e){return e.id===t});r=r[0];var o=r.name,a=r.bio,n=r.schoolBio;storySelected=r.name+" was",pageSix(o);var s=d3.select("#storyTime").append("div").attr("class","storyTime").html("<div id='storyName'></div><div id='storyBio'></div><div id='storySchoolBio'></div><div id='storyStories'></div>"),l=d3.select("#storyName").append("h1").attr("class","name").html("<span class='storyName'>"+o+"</span>"),i=d3.select("#storyBio").append("div").attr("class","bio").html("<p>"+a+"</p>"),c=d3.select("#storySchoolBio").append("div").attr("class","schoolBio").html("<p>"+n+"</p>");storyName_p=new ScrollMagic.Scene({triggerElement:"#storyName",duration:"100%"}).offset(document.getElementById("storyName").offsetHeight/2+"px").setPin("#storyName").addTo(controller),storyBio_p=new ScrollMagic.Scene({triggerElement:"#storyBio",duration:"100%"}).offset(document.getElementById("storyBio").offsetHeight/2+"px").setPin("#storyBio").addTo(controller),storySchoolBio_p=new ScrollMagic.Scene({triggerElement:"#storySchoolBio",duration:"100%"}).offset(document.getElementById("storySchoolBio").offsetHeight/2+"px").setPin("#storySchoolBio").addTo(controller);for(var d=TweenMax.to("#storyName",.5,{opacity:"0"}),p=TweenMax.to("#storyBio",.5,{opacity:"0"}),y=TweenMax.to("#storySchoolBio",.5,{opacity:"0"}),u=new ScrollMagic.Scene({triggerElement:"#storyBio"}).triggerHook("onEnter").setTween(d).addTo(controller),g=new ScrollMagic.Scene({triggerElement:"#storySchoolBio"}).triggerHook("onEnter").setTween(p).addTo(controller),m=new ScrollMagic.Scene({triggerElement:"#storyStories"}).triggerHook("onEnter").setTween(y).addTo(controller),h=0;h<r.story.length;h++){var f=d3.select("#storyStories").append("div").attr("class","storyStories").attr("id","story-"+h);if(""===r.story[h].quote){var v=r.story[h].section,x=r.story[h].pre;f.html("<p class='story-section'>"+v+"</p><p class='story-quote'>"+x+"</p>")}else{var v=r.story[h].section,x=r.story[h].pre,A=r.story[h].quote,w=RiString(A),S=w.words(),T=w.pos();f.html("<p class='story-section'>"+v+"</p><p class='story-pre'>"+x+"</p><p class='story-quote'>&ldquo;<span id='story-quote-"+h+"'></span>&rdquo;</p>")}for(var I=0;I<S.length;I++)if(/[,.?\-]/.test(S[I+1]))var M=d3.select("#story-quote-"+h).append("span").attr("id","quote-"+I).attr("class","pos-"+T[I]).html(S[I]);else var M=d3.select("#story-quote-"+h).append("span").attr("id","quote-"+I).attr("class","pos-"+T[I]).html(S[I]+" ")}for(var h=0;h<r.story.length-1;h++){var b=h+1,D=new ScrollMagic.Scene({triggerElement:"#story-"+h,duration:"100%"}).offset(document.getElementById("story-"+h).offsetHeight/2+"px").setPin("#story-"+h).addTo(controller),j=TweenMax.to("#story-"+h,.5,{opacity:"0"});if(h<r.story.length)var L=new ScrollMagic.Scene({triggerElement:"#story-"+b}).triggerHook("onEnter").setTween(j).addTo(controller)}var k=r.story.length-1;storyStory_last_p=new ScrollMagic.Scene({triggerElement:"#story-"+k,duration:"100%"}).offset(document.getElementById("story-"+k).offsetHeight/2+"px").setPin("#story-"+k).addTo(controller);var j=TweenMax.to("#story-"+k,.5,{opacity:"0"}),L=new ScrollMagic.Scene({triggerElement:"#p6"}).triggerHook("onEnter").setTween(j).addTo(controller)})}function pageSix(t){d3.selectAll(".overlay").remove(),d3.selectAll(".dot").classed("schoolMarker",!0).style("opacity",1),d3.selectAll(".label").classed("schoolLabel",!0).style("opacity",1);var e=d3.select("#oneof").append("div").attr("class","overlay").html(storySelected+" one of an estimated <span class='orange'>150,000</span> Aboriginal children to attend a residential school in Canada."),r=d3.select("#thismany").append("div").attr("class","overlay").html("There were <span class='orange'>132</span> schools located throughout the country."),o=d3.select("#fromreserves").append("div").attr("class","overlay").html("Students were drawn from reserves, bands, and tribes all over Canada, some as far away as <span class='orange'>8000km</span>."),a=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1,d3.json("js/data/stories/stories.json",function(e){e=e.stories.filter(function(e){return e.name===t}),e=e[0],map.flyTo({center:[e.latLng.lng,e.latLng.lat],zoom:e.zoom,bearing:0,speed:100,curve:1,easing:function(t){return t}}),d3.select("#dot-"+e.schoolID).classed("schoolMarker",!1),d3.select("#label-"+e.schoolID).classed("schoolLabel",!1),new ScrollMagic.Scene({triggerElement:"#tMap1_zo"}).addTo(a).on("progress",function(t){"FORWARD"===t.scrollDirection?(d3.selectAll(".schoolLabel").style("opacity","0"),d3.selectAll(".schoolMarker").style("opacity","0"),map.flyTo({center:[-100,58],zoom:4,bearing:0,speed:1,curve:1,easing:function(t){return t}})):(d3.select("#dot-"+e.schoolID).style("opacity",1),d3.select("#label-"+e.schoolID).style("opacity",1),map.flyTo({center:[e.latLng.lng,e.latLng.lat],zoom:e.zoom,bearing:0,speed:5,curve:1,easing:function(t){return t}}))}),new ScrollMagic.Scene({triggerElement:"#tMap1_irs"}).addTo(a).on("progress",function(t){"FORWARD"===t.scrollDirection?(d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",1),d3.select("#label-"+e.schoolID).transition().duration(600).ease(d3.easeLinear).style("opacity",0)):(d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",0),d3.select("#label-"+e.schoolID).transition().duration(600).ease(d3.easeLinear).style("opacity",1))}),new ScrollMagic.Scene({triggerElement:"#tMap1_reserves"}).addTo(a).on("progress",function(t){"FORWARD"===t.scrollDirection?d3.selectAll(".reserveDot").style("display","block").transition().duration(600).ease(d3.easeLinear).style("opacity",.1):(d3.selectAll(".reserveDot").transition().duration(600).ease(d3.easeLinear).style("opacity",0),d3.selectAll(".reserveDot").transition().delay(600).style("display","none"))});var r=new ScrollMagic.Scene({triggerElement:"#oneof",duration:"150%"}).offset(document.getElementById("oneof").offsetHeight/2+"px").setPin("#oneof").addTo(a),o=TweenMax.to("#oneof",.5,{opacity:"0"}),n=new ScrollMagic.Scene({triggerElement:"#thismany"}).triggerHook("onEnter").setTween(o).addTo(a),s=new ScrollMagic.Scene({triggerElement:"#thismany",duration:"150%"}).offset(document.getElementById("thismany").offsetHeight/2+"px").setPin("#thismany").addTo(a),l=TweenMax.to("#thismany",.5,{opacity:"0"}),i=new ScrollMagic.Scene({triggerElement:"#fromreserves"}).triggerHook("onEnter").setTween(l).addTo(a),c=new ScrollMagic.Scene({triggerElement:"#fromreserves",duration:"100%"}).offset(document.getElementById("fromreserves").offsetHeight/2+"px").setPin("#fromreserves").addTo(a),d=TweenMax.to("#fromreserves",.5,{opacity:"0"}),p=new ScrollMagic.Scene({triggerElement:"#tMap1_connections"}).triggerHook("onLeave").setTween(d).addTo(a)})}function rightBarOut(t){setTimeout(function(){rightBar=!0,rightBarCurrent=!0},500);var e=t.latitude,r=t.longitude;rightBarData(t),d3.select("#rightBar").classed("rightBarOut",!0);var o=window.innerWidth/2;d3.select("#map").transition().delay(500).duration(0).style("height",window.innerHeight+"px").style("width",o+"px"),d3.select(".mapboxgl-ctrl-top-right").transition().delay(500).duration(500).style("opacity",1),map.flyTo({center:[r,e],zoom:10,bearing:0,speed:1,curve:1,easing:function(t){return t}}),""===t.listConnections||(d3.selectAll(t.class).classed("reserveDot",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity",".6"))}function rightBarData(t){d3.selectAll(".rRemove").remove();var e=t;d3.json("js/data/schools/"+t.schoolID+".json",function(e){var r=d3.select("#rTitle").append("h2").attr("class","rRemove").html(e.name.replace("IRS","Indian Residential School").replace("RS","Residential School")),o=d3.select("#rSub").append("p").attr("class","rRemove").html("Open from <span class='orange'>"+e.startYear+"</span> to <span class='orange'>"+e.endYear+"</span> in <span class='orange'>"+t.placeName+"</span>, <span class='orange'>"+t.province+"</span>.");if(0===e.data.reserves.length){var a=d3.select("#rReserves").append("div").attr("class","r1Content rRemove");a.append("h4").html("Data not yet available...")}else{var a=d3.select("#rReserves").append("div").attr("class","r1Content rRemove");a.append("h4").html("The school drew students from various bands, tribes, and reserves:");for(var n=0;n<t.reserves.length;n++){var s=t.distances[n];a.append("div").html("<span class='rReservesName'>"+t.reserves[n]+"</span> <span class='rReservesDistance'>("+Number(t.distances[n]).toFixed(0)+"km away)</span>")}}if(0===e.data.religiousGroups.length){var l=d3.select("#rReligiousGroups").append("div").attr("class","r1Content rRemove");l.append("h4").html("Data not yet available...")}else{var l=d3.select("#rReligiousGroups").append("div").attr("class","r1Content rRemove");l.append("h4").html("The school drew was affiliated with various religious groups:");for(var n=0;n<e.data.religiousGroups.length;n++)l.append("div").html("<span class='rReservesName'>"+e.data.religiousGroups[n].group+"</span>")}var i=e,c=i.startYear,d=i.endYear,p=i.data.enrollment,y=d3.select("#r3svg").append("svg").attr("class","rRemove").attr("id","svgR").style("width",$("#r3svg").width()+"px").style("height",$("#r3svg").height()+"px"),u={top:5,right:10,bottom:0,left:80},g=$("#r3svg").width()-u.left-u.right,m=$("#r3svg").height()-u.top-u.bottom,h=m/2,f=y.append("g").attr("transform","translate("+u.left+","+u.top+")"),v=d3.scaleLinear().range([0,g]).domain([c,d]),x=d3.scaleLinear().range([h,0]).domain([0,300]),A=f.append("g").attr("id","xAxis").style("transform","translate(0, -"+h+"px)"),w=f.append("g").attr("id","yAxis").style("transform","translate(0, 0)");A.attr("class","xAxis axis").call(d3.axisBottom(v).tickFormat(d3.format("d")).tickSizeInner(-m));var S=m-8,T=h-15;A.style("transform","translate(0px, "+S+"px)"),d3.select(".xAxis path").style("transform","translate(0px, 0px)"),d3.selectAll(".xAxis text").style("transform","translate(0px, -"+T+"px)"),w.attr("class","yAxis axis").call(d3.axisLeft(x).ticks(5).tickSizeInner(-g));var I=d3.line().curve(d3.curveMonotoneX).x(function(t){return v(t.year)}).y(function(t){return x(t.number)}),M=f.append("svg:path").attr("id","chart").attr("d",I(p)).attr("stroke","green").attr("stroke-widt",2).attr("fill","none").style("transform","translate(0,0px)"),b=i.data.management,D=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<span class='sMorgName'>"+t.orgName+"</span><br><span class='sMyear'>"+t.startYear+"-"+i.endYear+"</span>"});y.call(D);var j=f.append("line").attr("class","lineAI").attr("x1",0).attr("x2",g).attr("y1",h+32).attr("y2",h+32),L=f.append("line").attr("class","lineAI").attr("x1",0).attr("x2",g).attr("y1",h+50).attr("y2",h+50),k=f.append("line").attr("class","lineAI").attr("x1",0).attr("x2",g).attr("y1",h+65).attr("y2",h+65),B=f.append("line").attr("class","lineAI").attr("x1",0).attr("x2",g).attr("y1",h+80).attr("y2",h+80),P=f.append("line").attr("class","lineAI").attr("x1",0).attr("x2",g).attr("y1",h+95).attr("y2",h+95),E=f.append("line").attr("class","lineAI").attr("x1",0).attr("x2",g).attr("y1",h+110).attr("y2",h+110),R=f.selectAll(".sMbars").data(b).enter().append("line",".sMbars").attr("class","sMbar").attr("x1",function(t){return v(t.startYear)}).attr("x2",function(t){return v(t.endYear)-5}).attr("y1",h+32).attr("y2",h+32).on("mouseover",D.show).on("mouseout",D.hide),C=f.selectAll(".sMlabels").data(b).enter().append("text",".sMlabels").attr("class","sMlabel").attr("x",function(t){return v(t.startYear)}).attr("dy",11).attr("dx",3).attr("y",h+25).text(function(t){return t.org}),H=i.data.additionalInformation.filter(function(t){return"sexual"===t.type}),N=i.data.additionalInformation.filter(function(t){return"health"===t.type}),q=i.data.additionalInformation.filter(function(t){return"physical"===t.type}),_=i.data.additionalInformation.filter(function(t){return"policy"===t.type}),z=i.data.additionalInformation.filter(function(t){return"other"===t.type}),O=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.notes});y.call(O);var Y=f.append("text").attr("class","lEnrolment").attr("x",-h/2).attr("dy",2).attr("y",-40).attr("text-anchor","middle").text("Average Enrolment"),W=f.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",h+35).attr("text-anchor","end").text("Management"),F=f.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",h+50).attr("text-anchor","end").text("Sexual Abuse"),G=f.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",h+65).attr("text-anchor","end").text("Physical Abuse"),J=f.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",h+80).attr("text-anchor","end").text("Health/Medical"),Z=f.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",h+95).attr("text-anchor","end").text("Policy"),K=f.append("text").attr("class","lAI").attr("x",-10).attr("dy",2).attr("y",h+110).attr("text-anchor","end").text("Other Reports"),Q=f.selectAll(".AIsexual").data(H).enter().append("circle",".AIsexual").attr("class","AIsexual AIcircle").attr("cx",function(t){return v(t.date)}).attr("cy",h+50).attr("r",4).on("mouseover",O.show).on("mouseout",O.hide),U=f.selectAll(".AIphysical").data(q).enter().append("circle",".AIphysical").attr("class","AIphysical AIcircle").attr("cx",function(t){return v(t.date)}).attr("cy",h+65).attr("r",4).on("mouseover",O.show).on("mouseout",O.hide),X=f.selectAll(".AIhealth").data(N).enter().append("circle",".AIhealth").attr("class","AIhealth AIcircle").attr("cx",function(t){return v(t.date)}).attr("cy",h+80).attr("r",4).on("mouseover",O.show).on("mouseout",O.hide),V=f.selectAll(".AIpolicy").data(_).enter().append("circle",".AIpolicy").attr("class","AIpolicy AIcircle").attr("cx",function(t){return v(t.date)}).attr("cy",h+95).attr("r",4).on("mouseover",O.show).on("mouseout",O.hide),tt=f.selectAll(".AIother").data(z).enter().append("circle",".AIother").attr("class","AIother AIcircle").attr("cx",function(t){return v(t.date)}).attr("cy",h+110).attr("r",4).on("mouseover",O.show).on("mouseout",O.hide)})}function rightBarBack(){d3.select("#map").style("height",window.innerHeight+"px").style("width",window.innerWidth+"px"),d3.select("#rightBar").classed("rightBarOut",!1),d3.select(".mapboxgl-ctrl-top-right").transition().duration(200).style("opacity",0),d3.select(".mapboxgl-ctrl-top-right").transition().delay(500).duration(500).style("opacity",1),map.flyTo({center:[-100,58],zoom:4,bearing:0,speed:2,curve:1,easing:function(t){return t}}),d3.selectAll(".reserveDot").style("display","block").transition().duration(600).ease(d3.easeLinear).style("opacity",.1),d3.selectAll(".schoolMarker").transition().duration(600).ease(d3.easeLinear).style("opacity",1),d3.selectAll(".schoolLabel").style("opacity","0"),rightBar=!1}var storyID="mbrown";window.onload=drawStory(storyID);var orange="#f15a24",rightBar=!1,status="begin",drawn=!1,controller=new ScrollMagic.Controller;TweenLite.defaultOverwrite=!1;var map1=d3.select("#map1_cont").append("div").attr("class","map").attr("id","map");d3.select("#map").style("height",window.innerHeight+"px").style("width",window.innerWidth+"px"),mapboxgl.accessToken="pk.eyJ1Ijoic3ZpY2thcnMiLCJhIjoiY2l1aW5saDhkMDAwMTNvbDdmcTlncnp1cyJ9.wIpJKF-DW1C2uPgKnUtNWg";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/svickars/cj15o81vo00212rqu9mw0wgkp",center:[-92.01173055555556,50.12052777777778],zoom:9,attributionControl:!1});map.scrollZoom.disable(),map.dragRotate.disable(),map.addControl(new mapboxgl.Navigation);var map1_p=new ScrollMagic.Scene({triggerElement:"#tMap1_p",duration:"800%"}).triggerHook("onLeave").setPin("#map1_cont").on("enter",function(){status="map"}).addTo(controller),container=map.getCanvasContainer(),svg=d3.select(container).append("svg"),g=svg.append("g"),d3Projection=getD3(),path=d3.geoPath();d3.json("js/data/locations.json",function(t){function e(){d3Projection=getD3(),path.projection(d3Projection),p.attr("cx",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("cy",function(t){return d3Projection([t.longitude,t.latitude])[1]}),i.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),c.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),s.attr("x",function(t){return d3Projection([t.longitude,t.latitude])[0]}).attr("y",function(t){return d3Projection([t.longitude,t.latitude])[1]}),d.attr("cx",function(t){return d3Projection([t.lng,t.lat])[0]}).attr("cy",function(t){return d3Projection([t.lng,t.lat])[1]}),l.attr("x",function(t){return d3Projection([t.lng,t.lat])[0]}).attr("y",function(t){return d3Projection([t.lng,t.lat])[1]}),p.on("mouseover",r).on("click",function(t){rightBarOut(t),d3.event.stopPropagation()}).on("mouseout",a),d.on("mouseover",o).on("mouseout",n)}function r(t){d3.select("#dot-"+t.schoolID).classed("schoolMarker",!1),d3.selectAll(".schoolMarker").style("opacity",".25"),d3.select("#dot-"+t.schoolID).style("fill","#333").style("opacity",1),d3.selectAll("#sTip-"+t.schoolID).style("opacity","1.0"),""===t.listConnections||(d3.selectAll(t.class).classed("reserveDot",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity",".6")),d3.selectAll(".reserveDot").style("opacity",".05"),d3.selectAll(".connection").style("opacity",".05")}function o(t){d3.select("#rDot-"+t.id).classed("reserveDot",!1),d3.selectAll(".reserveDot").style("opacity",".025").style("fill","#333"),d3.selectAll("#rTip-"+t.id).style("opacity","1.0"),""===t.listConnections||(d3.selectAll(t.class).classed("schoolMarker",!1).classed("connection",!1),d3.selectAll(t.class).style("opacity","1"),d3.select("#rDot-"+t.id).style("opacity",.25)),d3.selectAll(".schoolMarker").style("opacity",".25"),d3.selectAll(".connection").style("opacity",".05")}function a(t){d3.selectAll(".dot").classed("schoolMarker",!0),d3.selectAll(".schoolMarker").style("fill",orange).style("opacity","1"),d3.selectAll("#sTip-"+t.schoolID).style("opacity","0"),d3.selectAll(".sTooltip").style("opacity","0"),d3.selectAll(".sTooltip2").style("opacity","0"),d3.selectAll(".rDot").classed("reserveDot",!0),d3.selectAll(".reserveDot").style("opacity",".1"),d3.selectAll(".conn").classed("connection",!0),d3.selectAll(".connection").style("opacity","0.25")}function n(t){d3.selectAll(".rDot").classed("reserveDot",!0),d3.selectAll(".reserveDot").style("opacity",".1"),d3.selectAll(".dot").classed("schoolMarker",!0),d3.selectAll(".schoolMarker").style("opacity","1"),d3.selectAll(".conn").classed("connection",!0),d3.selectAll(".connection").style("opacity","0.25"),d3.selectAll("#rTip-"+t.id).style("opacity","0"),d3.selectAll(".rTooltip").style("opacity","0")}var s=g.selectAll("text").data(t.schools).enter().append("text").attr("class","label schoolLabel").attr("id",function(t){return"label-"+t.schoolID}).attr("pointer-events","none").attr("dy","6px").attr("dx","10px").text(function(t){return t.locationName+" "+t.title}),l=g.selectAll(".rTip").data(t.reservations).enter().append("text",".rtip").attr("class","rTooltip").attr("id",function(t){return"rTip-"+t.id}).attr("pointer-events","none").attr("dx","20px").attr("dy","5px").text(function(t){return t.reserve}),i=g.selectAll(".sTip").data(t.schools).enter().append("text",".stip").attr("class","sTooltip").attr("id",function(t){return"sTip-"+t.schoolID}).attr("pointer-events","none").attr("dx","9px").attr("dy","5px").text(function(t){return t.locationName+" "+t.title}),c=g.selectAll(".sTip2").data(t.schools).enter().append("text",".stip2").attr("class","sTooltip2").attr("id",function(t){return"sTip-"+t.schoolID}).attr("pointer-events","none").attr("dx","9px").attr("dy","19px").text(function(t){return t.start+" - "+t.end}),d=g.selectAll(".rDot").data(t.reservations).enter().append("circle",".rDot").attr("pointer-events","visible").attr("class",function(t){return"rDot reserveDot "+t.listConnections}).attr("id",function(t){return"rDot-"+t.id}).style("stroke","none").style("display","none").style("opacity","0").style("fill","#333").attr("r",15),p=g.selectAll(".sCircle").data(t.schools).enter().append("circle",".sCircle").attr("class",function(t){return"schoolMarker dot "+t.listConnections}).attr("pointer-events","visible").attr("id",function(t){return"dot-"+t.schoolID}).style("stroke","none").style("opacity",1).style("fill",orange).attr("r",5);map.on("viewreset",function(){e()}),map.on("move",function(){e()}),e()}),d3.json("js/data/connections.json",function(t){function e(){d3Projection=getD3(),path.projection(d3Projection),!1===drawn?r.attr("x1",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y1",function(t){return d3Projection([t.sLng,t.sLat])[1]}).attr("x2",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y2",function(t){return d3Projection([t.sLng,t.sLat])[1]}):r.attr("x1",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y1",function(t){return d3Projection([t.sLng,t.sLat])[1]}).attr("x2",function(t){return d3Projection([t.eLng,t.eLat])[0]}).attr("y2",function(t){return d3Projection([t.eLng,t.eLat])[1]})}var r=g.selectAll("line").data(t).enter().append("line").attr("class",function(t){return"connection conn "+t.id}).attr("id",function(t){return"conn-"+t.id}).style("stroke",orange).style("opacity",.25);new ScrollMagic.Scene({triggerElement:"#tMap1_connections"}).addTo(controller).on("progress",function(t){"FORWARD"===t.scrollDirection?(drawn=!0,r.transition().duration(1500).attr("x2",function(t){return d3Projection([t.eLng,t.eLat])[0]}).attr("y2",function(t){return d3Projection([t.eLng,t.eLat])[1]})):(drawn=!1,r.transition().duration(1500).attr("x2",function(t){return d3Projection([t.sLng,t.sLat])[0]}).attr("y2",function(t){return d3Projection([t.sLng,t.sLat])[1]}))}),map.on("viewreset",function(){e()}),map.on("move",function(){e()}),map.on("rotate",function(){e()}),e()}),jQuery("#stories-select").draggable({axis:"x",cursor:"move",containment:"stories"});var storiesSelectScroll=(new TimelineMax).to("#stories-select",1,{x:"-50%",delay:.25}),p4pin=new ScrollMagic.Scene({triggerElement:"#p4",triggerHook:"onLeave",duration:"200%"}).setPin("#p4").setTween(storiesSelectScroll).addTo(controller);d3.json("js/data/stories/stories.json",function(t){for(var e=0;e<t.stories.length;e++){var r=d3.select("#stories-select").append("div").attr("class","story-option-container").attr("id",t.stories[e].id).on("click",function(t,e){storyID=d3.select(this).attr("id"),d3.selectAll(".story-option-container").transition().duration(200).ease(d3.easeLinear).style("opacity",.1),d3.select("#"+storyID).transition().duration(200).ease(d3.easeLinear).style("opacity",1),drawStory(storyID),p4pin.destroy()});d3.select("#"+t.stories[e].id).append("div").attr("class","story-option-circle").attr("id","story-option"+e).style("background","linear-gradient(rgba(241, 90, 36, 0.25),rgba(241, 90, 36, 0.25)), url('js/data/stories/images/"+t.stories[e].picture+"'), rgb(241, 90, 36)").style("background-size","10em");d3.select("#"+t.stories[e].id).append("div").attr("class","story-label").html("<p class='story-option-name'>"+t.stories[e].name+"</p><p class='story-option-quote'>&ldquo;"+t.stories[e].pull+"&rdquo;</p>")}}),map.on("click",function(t){!0===rightBar&&rightBarBack(t)});